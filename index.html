<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù†Ø¬Ø§Ø² 2026 Pro | Ù†Ø¸Ø§Ù… Ù…ÙÙ€Ø¯Ø§Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø¥Ù†Ø¬Ø§Ø² 2026">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1162/1162456.png">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

    <style>
        /* Ø¶Ø¹ ÙƒÙ„ ÙƒÙˆØ¯ Ø§Ù„Ù€ CSS Ù‡Ù†Ø§ ÙƒÙ…Ø§ Ù‡Ùˆ Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± */
        :root {
    /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ) */
    --primary: #6366f1; 
    --secondary: #a855f7; 
    --sidebar-bg: #0f172a; 
    --main-bg: #05070a;
    --card: rgba(15, 23, 42, 0.8);
    --text: #ffffff; 
    --text-sub: #94a3b8;
    --border: rgba(255, 255, 255, 0.1); 
}

/* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ */
body.light-mode {
    --sidebar-bg: #f1f5f9;
    --main-bg: #ffffff;
    --card: rgba(255, 255, 255, 0.9);
    --text: #1e293b;
    --text-sub: #64748b;
    --border: rgba(0, 0, 0, 0.1);
}
        :root {
            
            --primary: #6366f1; --secondary: #a855f7; 
            --sidebar-bg: #0f172a; --main-bg: #05070a;
            --card: rgba(10, 15, 30, 0.9);
            --text: #ffffff; --text-sub: #94a3b8;
            --border: rgba(255, 255, 255, 0.1); 
            --success: #10b981; --warning: #f59e0b;
        }

        body {
            font-family: 'Cairo', sans-serif;
            margin: 0; display: flex; height: 100vh;
            background-color: var(--main-bg); color: var(--text);
            overflow: hidden;
        }

        /* Sidebar Styling */
        .sidebar { 
            width: 280px; background: var(--sidebar-bg); color: white; 
            display: flex; flex-direction: column; padding: 30px 20px; 
            position: fixed; right: -320px; height: 100%; z-index: 2000; 
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: -10px 0 30px rgba(0,0,0,0.3);
        }
        .sidebar.open { right: 0; }

        .menu-toggle {
            position: fixed; top: 20px; right: 20px; z-index: 2100;
            background: var(--primary); color: white; border: none;
            width: 45px; height: 45px; border-radius: 12px; cursor: pointer;
            font-size: 1.5rem; display: flex; align-items: center; justify-content: center;
        }

        .main-container { flex: 1; padding: 40px; overflow-y: auto; padding-top: 80px; transition: 0.3s; }
        
        .achievement-box {
            background: linear-gradient(145deg, rgba(99, 102, 241, 0.15), rgba(168, 85, 247, 0.15));
            backdrop-filter: blur(15px); border: 1px solid var(--border);
            border-radius: 30px; padding: 30px; margin-bottom: 20px;
        }
        .prog-pct { font-size: 3rem; font-weight: 900; color: #fff; text-shadow: 0 0 20px var(--primary); }
        .prog-track { height: 12px; background: rgba(255,255,255,0.05); border-radius: 20px; overflow: hidden; }
        .prog-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary), var(--secondary)); transition: 1s; }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 20px; text-align: center; }

        .glass-panel { background: var(--card); border-radius: 25px; padding: 25px; border: 1px solid var(--border); margin-bottom: 20px; }
        input, select, button, textarea { padding: 12px; border-radius: 15px; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: white; font-family: 'Cairo'; }
        
        .goal-item { 
            background: rgba(255,255,255,0.03); padding: 18px; border-radius: 20px; 
            margin-bottom: 12px; display: flex; align-items: center; gap: 15px; border: 1px solid var(--border);
        }
        .completed { opacity: 0.4; filter: grayscale(1); }

        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .menu-item { padding: 14px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .menu-item.active { background: var(--primary); }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; z-index: 1500; backdrop-filter: blur(3px); }
        .overlay.show { display: block; }

        /* Weekly Table Styling */
        .weekly-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .day-card { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 20px; padding: 15px; }
        .day-title { color: var(--primary); font-weight: bold; border-bottom: 1px solid var(--border); margin-bottom: 10px; padding-bottom: 5px; }
        .day-input { width: 100%; background: transparent; border: none; color: var(--text-sub); font-size: 0.9rem; resize: none; outline: none; }
   
/* Ø²Ø± ÙØªØ­ Ø§Ù„Ø´Ø§Øª */
        #chat-circle {
            position: fixed; bottom: 20px; right: 20px;
            width: 60px; height: 60px; border-radius: 50%;
            background: #37474f; color: white; border: none;
            cursor: pointer; font-size: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            z-index: 1000; transition: transform 0.3s;
        }
        #chat-circle:hover { transform: scale(1.1); }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø§Øª (Ø§Ù„Ù†Ù…Ø· Ø§Ù„ØºØ§Ù…Ù‚) */
        #chat-window {
            position: fixed; bottom: 90px; right: 20px;
            width: 350px; height: 500px; background: #1e1e1e; /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ Ù…Ø®ÙÙØ© */
            border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            display: none; flex-direction: column; overflow: hidden;
            font-family: 'Segoe UI', Arial, sans-serif; z-index: 1000;
            border: 1px solid #333;
        }

        /* Ø±Ø£Ø³ Ø§Ù„Ø´Ø§Øª Ù…Ø¹ Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ */
        .chat-header { 
            background: #2d2d2d; color: #fff; padding: 15px; 
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #3d3d3d;
        }
        .close-btn { 
            background: none; border: none; color: #ff5f56; 
            font-size: 20px; cursor: pointer; font-weight: bold; 
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        #chat-messages { 
            flex: 1; padding: 15px; overflow-y: auto; 
            display: flex; flex-direction: column; gap: 12px; 
            background: #121212; /* Ø®Ù„ÙÙŠØ© Ø£ØºÙ…Ù‚ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ */
        }
        
        .msg { padding: 10px 14px; border-radius: 12px; max-width: 85%; font-size: 14px; line-height: 1.4; }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        .user { 
            background: #007bff; color: white; align-self: flex-start; 
            border-bottom-right-radius: 2px; 
        }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª */
        .bot { 
            background: #333; color: #e0e0e0; align-self: flex-end; 
            border-bottom-left-radius: 2px; border: 1px solid #444;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .chat-input-area { 
            background: #2d2d2d; padding: 12px; 
            display: flex; border-top: 1px solid #3d3d3d; 
        }
        #user-input { 
            flex: 1; border: none; background: #3d3d3d; color: white; 
            padding: 8px 12px; border-radius: 20px; outline: none; 
        }
        #send-btn { 
            background: none; border: none; color: #007bff; 
            margin-right: 10px; cursor: pointer; font-weight: bold; 
        }

        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        #chat-messages::-webkit-scrollbar { width: 5px; }
        #chat-messages::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }
    </style>


<body onload="initApp()">
    <div id="connectionStatus" style="
    position: fixed; 
    top: 0; 
    width: 100%; 
    padding: 10px; 
    text-align: center; 
    font-size: 0.8rem; 
    font-weight: bold; 
    z-index: 9999; 
    display: none; 
    transition: 0.5s;">
</div>
    <div style="position: fixed; top: -10%; left: -10%; width: 400px; height: 400px; background: var(--primary); filter: blur(150px); opacity: 0.15; z-index: -1;"></div>
<div style="position: fixed; bottom: -10%; right: -10%; width: 500px; height: 500px; background: var(--secondary); filter: blur(180px); opacity: 0.15; z-index: -1;"></div>
    

    <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
    <div id="overlay" class="overlay" onclick="toggleSidebar()"></div>

   <div id="sidebar" class="sidebar">
    <h1 style="text-align:center; ">Ù…ÙÙ€Ø¯Ø§Ø± 2026</h1>
    <div class="menu-item active" onclick="showPage('home', this)">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ø£Ù‡Ø¯Ø§Ù)</div>
    <div class="menu-item" onclick="showPage('pomodoro-page', this)">â±ï¸ Ù…Ø¤Ù‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ² (55-5)</div> 
    <div class="menu-item" onclick="showPage('weekly', this)">ğŸ“… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</div>
    <div class="menu-item" onclick="showPage('reports', this)">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
    <div class="menu-item" onclick="showPage('settings', this)">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
</div>

    <div class="main-container">
        
        <div id="home" class="page active">
            <header style="margin-bottom: 30px;">
                <h2 style="margin:0;">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª ğŸš€</h2>
            </header>

            <div class="achievement-box">
                <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px;">
                    <span style="color: var(--text-sub);">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„ÙƒÙ„ÙŠ</span>
                    <span class="prog-pct" id="progValue">0%</span>
                </div>
                <div class="prog-track">
                    <div id="progFill" class="prog-fill"></div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card"><span id="statTotal" style="font-size:1.8rem; font-weight:900;">0</span><br><small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</small></div>
                <div class="stat-card"><span id="statDone" style="font-size:1.8rem; font-weight:900; color:var(--success);">0</span><br><small>ØªÙ… Ø¨Ù†Ø¬Ø§Ø­</small></div>
                <div class="stat-card"><span id="statPending" style="font-size:1.8rem; font-weight:900; color:var(--warning);">0</span><br><small>Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</small></div>
            </div>

            <div class="glass-panel">
    <input type="text" id="goalTitle" placeholder="Ù…Ø§ Ù‡ÙŠ Ø®Ø·ØªÙƒ Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ" style="width: 100%; box-sizing: border-box; margin-bottom: 15px;">
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 100px; gap: 10px;">
        <select id="goalDay">
            <option value="Ø§Ù„Ø³Ø¨Øª" style="color: #05070a;">Ø§Ù„Ø³Ø¨Øª</option>
            <option value="Ø§Ù„Ø£Ø­Ø¯"style="color: #05070a;">Ø§Ù„Ø£Ø­Ø¯</option>
            <option value="Ø§Ù„Ø§Ø«Ù†ÙŠÙ†"style="color: #05070a;">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
            <option value="Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡"style="color: #05070a;">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
            <option value="Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"style="color: #05070a;">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
            <option value="Ø§Ù„Ø®Ù…ÙŠØ³"style="color: #05070a;">Ø§Ù„Ø®Ù…ÙŠØ³</option>
            <option value="Ø§Ù„Ø¬Ù…Ø¹Ø©"style="color: #05070a;">Ø§Ù„Ø¬Ù…Ø¹Ø©</option>
        </select>
        <select id="goalCat">
            <option value="Ø¹Ø§Ù…"style="color: #05070a;">Ø¹Ø§Ù…</option>
            <option value="Ø¹Ù…Ù„ ğŸ’¼"style="color: #05070a;">Ø¹Ù…Ù„</option>
            <option value="ØªØ·ÙˆÙŠØ± ğŸ“š"style="color: #05070a;">ØªØ·ÙˆÙŠØ±</option>
        </select>
        <input type="date" id="goalDate">
        <button onclick="saveGoal()" style="background:var(--primary); border:none; font-weight:bold; cursor:pointer;">Ø¥Ø¶Ø§ÙØ©</button>
    </div>
    
</div>
            <div id="goalsList"></div>
        </div>

        <div id="weekly" class="page">
            <h2>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ ğŸ“…</h2>
            <div class="glass-panel">
                <div class="weekly-grid" id="weeklyGrid">
                    </div>
                <button onclick="exportWeeklyReport()" style="width:100%; margin-top:10px; background:var(--secondary); border:none; padding:15px; font-weight:bold; cursor:pointer; border-radius:15px;">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ </button>
            </div>
        </div>

      <div id="reports" class="page">
    <h2>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ ğŸ“Š</h2>
    <div class="stats-grid">
        <div class="glass-panel" style="grid-column: span 2;">
            <p style="text-align: center; color: var(--primary); font-weight: bold;">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
            <canvas id="lineChart" style="max-height: 300px;"></canvas>
        </div>
        <div class="glass-panel">
            <p style="text-align: center; color: var(--secondary); font-weight: bold;">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</p>
            <canvas id="doughnutChart" style="max-height: 300px;"></canvas>
        </div>
    </div>
    <button onclick="exportReport()" style="width:100%; background:var(--secondary); border:none; padding:15px; font-weight:bold; cursor:pointer; border-radius:15px;">ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± </button>
</div>
        <div id="settings" class="page">
    <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ âš™ï¸</h2>
    
    <div class="glass-panel" style="text-align: center;">
        <div style="position: relative; display: inline-block;">
            <img id="profileImgDisplay" src="https://via.placeholder.com/100" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover;">
            <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="updateProfileImage(this)">
            <button onclick="document.getElementById('imageInput').click()" style="position: absolute; bottom: 0; right: 0; width: 30px; height: 30px; border-radius: 50%; padding: 0; font-size: 0.8rem;">ğŸ“·</button>
        </div>
        
        <div style="margin-top: 15px;">
            <input type="text" id="userNameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" style="text-align: center; width: 80%;">
            <p id="nameTimer" style="font-size: 0.8rem; color: var(--warning); margin-top: 5px;"></p>
            <button onclick="saveProfileName()" id="saveNameBtn" style="background: var(--primary); width: 80%; margin-top: 10px;">Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…</button>
        </div>
    </div>

    <div class="glass-panel">
        <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
        <button onclick="if(confirm('Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')){localStorage.clear(); location.reload();}" style="background:#ef4444; width:100%; border:none; padding:15px; cursor:pointer; border-radius:15px; font-weight:bold;">ğŸ—‘ Ù…Ø³Ø­ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>
</div>
<div id="pomodoro-page" class="page">
    <h2>Ù…Ø¤Ù‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø¹Ù…ÙŠÙ‚ (55-5) â±ï¸</h2>
    
    <div class="glass-panel" style="text-align: center; padding: 50px 20px; border: 2px solid var(--primary); background: linear-gradient(145deg, rgba(99, 102, 241, 0.05), rgba(168, 85, 247, 0.05));">
        <p id="timer-status" style="color: var(--text-sub); margin-bottom: 20px;">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡ØŸ</p>
        
        <div style="font-size: 6rem; font-weight: 900; margin: 30px 0; font-family: 'monospace'; color: var(--text); text-shadow: 0 0 30px var(--primary);" id="timer-display">55:00</div>
        <div id="madar-advice-box" class="glass-panel" style="margin-top: 20px; border-left: 4px solid var(--primary); padding: 15px;">
    <small style="color: var(--primary); display: block; margin-bottom: 5px;">ğŸ’¡ Ù†ØµÙŠØ­Ø© Ù…ÙÙ€Ø¯Ø§Ø± Ù„Ù„ØªØ±ÙƒÙŠØ²:</small>
    <p id="advice-text" style="font-style: italic; font-size: 0.95rem; color: var(--text-sub);">
        "Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ØµØºÙŠØ±Ø© Ù„ØªÙƒØªØ³Ø¨ Ø·Ø§Ù‚Ø© Ù„Ù„Ø¥Ù†Ø¬Ø§Ø²."
    </p>
</div>
        
        <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 30px;">
            <button onclick="startTimer()" id="start-btn" style="background: var(--success); padding: 15px 40px; font-size: 1.2rem; font-weight: bold; cursor: pointer; border: none; border-radius: 15px; color: white;">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ±ÙƒÙŠØ²</button>
            <button onclick="pauseTimer()" id="pause-btn" style="background: var(--warning); padding: 15px 40px; font-size: 1.2rem; font-weight: bold; cursor: pointer; border: none; border-radius: 15px; display: none; color: white;">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
            <button onclick="resetTimer()" style="background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid #ef4444; padding: 15px 30px; font-weight: bold; cursor: pointer; border-radius: 15px;">Ø¥Ø¹Ø§Ø¯Ø©</button>
        </div>

        <div style="display: flex; justify-content: center; gap: 15px;">
            
        </div>
    </div>

    <audio id="alarm-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

    <audio id="alarm-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
</div>
<button id="chat-circle" onclick="toggleChat()">ğŸ’¬</button>

<div id="chat-window">
    <div class="chat-header">
        <span>ğŸ¤– Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ</span>
        <button class="close-btn" onclick="toggleChat()">âœ•</button>
    </div>
    <div id="chat-messages">
        <div class="msg bot">Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ø£Ø¹Ù…Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ù†Ù…Ø· Ù„ÙŠÙ„ÙŠØŒ ÙƒÙŠÙ Ø£Ø³Ø§Ø¹Ø¯ÙƒØŸ</div>
    </div>
    <div class="chat-input-area">
        <input type="text" id="user-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." onkeypress="handleKeyPress(event)">
        <button id="send-btn" onclick="askAI()">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>
<script>
    function exportWeeklyReport() {
    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† Ø§Ù„Ù€ LocalStorage
    const saved = JSON.parse(localStorage.getItem('weekly_plan_2026') || '{}');
    
    if (Object.keys(saved).length === 0) {
        alert("Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙØ§Ø±Øº! ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù…Ù‡Ø§Ù… ÙˆØ­ÙØ¸Ù‡Ø§ Ø£ÙˆÙ„Ø§Ù‹.");
        return;
    }

    let reportText = "ØªØ·Ø¨ÙŠÙ‚ Ù…ÙÙ€Ø¯Ø§Ø± 2026 - ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ\n";
    reportText += "==========================================\n\n";

    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙŠØ§Ù… Ø¨Ù†ÙØ³ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    const weekDays = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];

    weekDays.forEach(day => {
        const tasks = saved[day] || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…Ø³Ø¬Ù„Ø©";
        reportText += `ğŸ“… ÙŠÙˆÙ… ${day}:\n`;
        reportText += `${tasks}\n`;
        reportText += "---------------------------\n";
    });

    // Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ù…ÙŠÙ„
    const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `Weekly_Plan_2026.txt`;
    link.click();
    
    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    URL.revokeObjectURL(link.href);
}
    const currentUser = "default_user";
    let myChart = null;
    const days = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
        document.getElementById('overlay').classList.toggle('show');
    }

    function showPage(pageId, element) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        element.classList.add('active');
        if(window.innerWidth < 768) toggleSidebar();
        if(pageId === 'reports') updateChart();
        if(pageId === 'weekly') loadWeekly();
    }

    function initApp() {
        loadData();
        renderWeeklyInputs();
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ÙØ­Øµ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
checkTimerOnLoad();
    }

    // Weekly Logic
  // Ø§Ø³ØªØ¨Ø¯Ù„ ÙˆØ¸ÙŠÙØ© renderWeeklyInputs Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø©
function renderWeeklyInputs() {
    const grid = document.getElementById('weeklyGrid');
    grid.innerHTML = days.map(day => `
        <div class="day-card" style="border-right: 4px solid var(--primary);">
            <div class="day-title">${day}</div>
            <div class="day-input" id="day-${day}" 
                 style="min-height: 100px; white-space: pre-line; font-size: 0.9rem; color: var(--text-sub);">
                 </div>
        </div>
    `).join('');
}

    function saveWeekly() {
        const weeklyData = {};
        days.forEach(day => {
            weeklyData[day] = document.getElementById(`day-${day}`).value;
        });
        localStorage.setItem('weekly_plan_2026', JSON.stringify(weeklyData));
        alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ø¨Ù†Ø¬Ø§Ø­! âœ…');
    }

   function loadWeekly() {
    // 1. Ø¬Ù„Ø¨ ÙƒØ§ÙØ© Ø§Ù„Ù…Ù‡Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    const allData = JSON.parse(localStorage.getItem('user_vault_2026') || '{}');
    const myGoals = allData[currentUser] || [];

    // 2. ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    days.forEach(day => {
        const dayContainer = document.getElementById(`day-${day}`);
        
        // 3. ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ÙÙ‚Ø·
        const dayTasks = myGoals.filter(g => g.day === day);
        
        if (dayTasks.length > 0) {
            dayContainer.innerHTML = dayTasks.map(g => 
                `<div style="margin-bottom: 5px; ${g.done ? 'text-decoration: line-through; opacity: 0.5;' : ''}">
                    ${g.done ? 'âœ…' : 'ğŸ“Œ'} ${g.title}
                </div>`
            ).join('');
        } else {
            dayContainer.innerHTML = `<span style="opacity: 0.3; font-style: italic;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…..</span>`;
        }
    });
}
    // Rest of your original functions
    function saveGoal() {
    const title = document.getElementById('goalTitle').value.trim();
    const date = document.getElementById('goalDate').value;
    const day = document.getElementById('goalDay').value; // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø®ØªØ§Ø±
    const category = document.getElementById('goalCat').value;

    if(!title) return;

    // 1. Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    const allData = JSON.parse(localStorage.getItem('user_vault_2026') || '{}');
    if(!allData[currentUser]) allData[currentUser] = [];
    allData[currentUser].push({ 
        id: Date.now(), title: title, day: day, cat: category, date: date || "Ø¨Ù„Ø§ ØªØ§Ø±ÙŠØ®", done: false 
    });
    localStorage.setItem('user_vault_2026', JSON.stringify(allData));

    // 2. Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ (Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ø¬Ø¯ÙˆÙ„)
    const weeklyData = JSON.parse(localStorage.getItem('weekly_plan_2026') || '{}');
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù†Øµ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…
    const currentTasks = weeklyData[day] || "";
    weeklyData[day] = currentTasks + (currentTasks ? "\n" : "") + `- ${title} (${category})`;
    
    localStorage.setItem('weekly_plan_2026', JSON.stringify(weeklyData));

    // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    document.getElementById('goalTitle').value = '';
    loadData();
    
    // ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø³ÙŠØ· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    console.log(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„ÙŠÙˆÙ…: ${day}`);
}
function showPage(pageId, element) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
    element.classList.add('active');
    
    if(window.innerWidth < 768) toggleSidebar();
    
    if(pageId === 'reports') updateChart();
    
    // Ø¹Ù†Ø¯ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŒ Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
    if(pageId === 'weekly') loadWeekly(); 
}
    function loadData() {
        const allData = JSON.parse(localStorage.getItem('user_vault_2026') || '{}');
        const myGoals = allData[currentUser] || [];
        const listDiv = document.getElementById('goalsList');
        listDiv.innerHTML = '';
        let doneCount = 0;

        myGoals.sort((a,b) => a.done - b.done).forEach(g => {
            if(g.done) doneCount++;
            const div = document.createElement('div');
            div.className = `goal-item ${g.done ? 'completed' : ''}`;
            div.innerHTML = `
                <input type="checkbox" ${g.done ? 'checked' : ''} onchange="toggleGoal(${g.id})" style="width:20px; height:20px;">
                <div style="flex:1">
                    <b style="display:block;">${g.title}</b>
                    <small style="color:var(--text-sub)">${g.cat} | ğŸ“… ${g.date}</small>
                </div>
                <button onclick="deleteGoal(${g.id})" style="background:none; border:none; cursor:pointer;">ğŸ—‘ï¸</button>
            `;
            listDiv.appendChild(div);
        });

        const total = myGoals.length;
        const percent = total ? Math.round((doneCount / total) * 100) : 0;
        document.getElementById('progValue').innerText = percent + '%';
        document.getElementById('progFill').style.width = percent + '%';
        document.getElementById('statTotal').innerText = total;
        document.getElementById('statDone').innerText = doneCount;
        document.getElementById('statPending').innerText = total - doneCount;
    }

    function toggleGoal(id) {
        let allData = JSON.parse(localStorage.getItem('user_vault_2026'));
        allData[currentUser] = allData[currentUser].map(g => g.id === id ? {...g, done: !g.done} : g);
        localStorage.setItem('user_vault_2026', JSON.stringify(allData));
        loadData();
    }

    function deleteGoal(id) {
        let allData = JSON.parse(localStorage.getItem('user_vault_2026'));
        allData[currentUser] = allData[currentUser].filter(g => g.id !== id);
        localStorage.setItem('user_vault_2026', JSON.stringify(allData));
        loadData();
    }

    function updateChart() {
        const allData = JSON.parse(localStorage.getItem('user_vault_2026') || '{}');
        const myGoals = allData[currentUser] || [];
        const done = myGoals.filter(g => g.done).length;
        const pending = myGoals.length - done;

        if(myChart) myChart.destroy();
        const ctx = document.getElementById('productivityChart').getContext('2d');
        myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Ù…Ù†Ø¬Ø²', 'Ù…ØªØ¨Ù‚ÙŠ'],
                datasets: [{ data: [done, pending], backgroundColor: ['#10b981', '#334155'], borderWidth: 0 }]
            },
            options: { plugins: { legend: { labels: { color: '#fff', font: { family: 'Cairo' } } } } }
        });
    }

    function exportReport() {
        const allData = JSON.parse(localStorage.getItem('user_vault_2026') || '{}');
        const myGoals = allData[currentUser] || [];
        let txt = "ØªÙ‚Ø±ÙŠØ± Ø£Ù‡Ø¯Ø§Ù 2026\n\n";
        myGoals.forEach(g => txt += `${g.done ? '[âœ“]' : '[ ]'} ${g.title} - ${g.date}\n`);
        const blob = new Blob([txt], {type: 'text/plain'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'report.txt';
        a.click();
    }
    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
function loadProfile() {
    const profile = JSON.parse(localStorage.getItem('user_profile_2026') || '{}');
    
    if (profile.name) document.getElementById('userNameInput').value = profile.name;
    if (profile.image) document.getElementById('profileImgDisplay').src = profile.image;
    
    checkNameChangeAvailability();
}

// ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Base64 Ù„ØªØ¹Ù…Ù„ Ù…Ø¹ LocalStorage)
function updateProfileImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const imageData = e.target.result;
            document.getElementById('profileImgDisplay').src = imageData;
            
            const profile = JSON.parse(localStorage.getItem('user_profile_2026') || '{}');
            profile.image = imageData;
            localStorage.setItem('user_profile_2026', JSON.stringify(profile));
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù… Ù…Ø¹ Ø´Ø±Ø· Ø§Ù„Ø³Ø¨Ø¹Ø© Ø£ÙŠØ§Ù…
function saveProfileName() {
    const newName = document.getElementById('userNameInput').value.trim();
    if (!newName) return;

    const profile = JSON.parse(localStorage.getItem('user_profile_2026') || '{}');
    const now = new Date().getTime();
    const sevenDaysInMs = 7 * 24 * 60 * 60 * 1000;

    if (profile.lastUpdate && (now - profile.lastUpdate < sevenDaysInMs)) {
        alert("Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¢Ù†ØŒ ÙŠØ¬Ø¨ Ù…Ø±ÙˆØ± 7 Ø£ÙŠØ§Ù… Ø¹Ù„Ù‰ Ø¢Ø®Ø± ØªØºÙŠÙŠØ±.");
        return;
    }

    profile.name = newName;
    profile.lastUpdate = now;
    localStorage.setItem('user_profile_2026', JSON.stringify(profile));
    
    alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ù‚ÙÙ„ Ù…ÙØ¹Ù„ Ø§Ù„Ø¢Ù† Ù„Ù…Ø¯Ø© 7 Ø£ÙŠØ§Ù….");
    checkNameChangeAvailability();
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù‚ÙÙ„ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
function checkNameChangeAvailability() {
    const profile = JSON.parse(localStorage.getItem('user_profile_2026') || '{}');
    const input = document.getElementById('userNameInput');
    const btn = document.getElementById('saveNameBtn');
    const timerText = document.getElementById('nameTimer');

    if (profile.lastUpdate) {
        const now = new Date().getTime();
        const sevenDaysInMs = 7 * 24 * 60 * 60 * 1000;
        const timePassed = now - profile.lastUpdate;

        if (timePassed < sevenDaysInMs) {
            const daysLeft = Math.ceil((sevenDaysInMs - timePassed) / (1000 * 60 * 60 * 24));
            input.disabled = true;
            btn.style.opacity = "0.5";
            btn.disabled = true;
            timerText.innerText = `Ù…ØªØ§Ø­ Ø§Ù„ØªØºÙŠÙŠØ± Ø¨Ø¹Ø¯ ${daysLeft} ÙŠÙˆÙ…`;
        } else {
            input.disabled = false;
            btn.style.opacity = "1";
            btn.disabled = false;
            timerText.innerText = "ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¢Ù†";
        }
    }
}

// Ù„Ø§ ØªÙ†Ø³Ù Ø¥Ø¶Ø§ÙØ© loadProfile() Ø¯Ø§Ø®Ù„ ÙˆØ¸ÙŠÙØ© initApp() Ø§Ù„Ø£ØµÙ„ÙŠØ©
function initApp() {
    loadData();
    renderWeeklyInputs(); // Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
    loadProfile(); // Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    if (Notification.permission !== 'granted') {
    Notification.requestPermission();
    const focusAdvices = [
    "Ø£Ø¨Ø¹Ø¯ Ù‡Ø§ØªÙÙƒ Ø¹Ù† Ù…ØªÙ†Ø§ÙˆÙ„ ÙŠØ¯Ùƒ ØªÙ…Ø§Ù…Ø§Ù‹ Ø§Ù„Ø¢Ù†.",
    "Ø§Ø´Ø±Ø¨ ÙƒÙˆØ¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø§Ø¡ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©.",
    "ØªØ°ÙƒØ±: Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ø³ØªÙ…Ø± Ø§Ù„ØµØºÙŠØ± Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„ÙƒØ¨ÙŠØ±.",
    "Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù…Ù‡Ù…Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·ØŒ ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù… ÙŠØ´ØªØª Ø°ÙƒØ§Ø¡Ùƒ.",
    "Ø®Ø° Ù†ÙØ³Ø§Ù‹ Ø¹Ù…ÙŠÙ‚Ø§Ù‹.. Ø£Ù†Øª ØªÙ‚ÙˆÙ… Ø¨Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹!",
    "Ø¥Ø°Ø§ Ø´Ø¹Ø±Øª Ø¨Ø§Ù„ØªØ¹Ø¨ØŒ ØªØ°ÙƒØ± Ù„Ù…Ø§Ø°Ø§ Ø¨Ø¯Ø£Øª.",
    "Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…Ù†Ø¸Ù…Ø© ØªØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø¹Ù‚Ù„ Ù…Ù†Ø¸Ù…ØŒ Ø±ØªØ¨ Ù…ÙƒØªØ¨Ùƒ Ø³Ø±ÙŠØ¹Ø§Ù‹.",
    "Ù„Ø§ ØªÙ†ØªØ¸Ø± Ø§Ù„ØªØ­ÙÙŠØ²ØŒ Ø§Ø¨Ø¯Ø£ ÙˆØ³ÙˆÙ ÙŠÙ„Ø­Ù‚ Ø¨Ùƒ Ø§Ù„ØªØ­ÙÙŠØ² Ù„Ø§Ø­Ù‚Ø§Ù‹."
];
function showMadarAdvice() {
    const adviceText = document.getElementById('advice-text');
    if (adviceText) {
        const randomIndex = Math.floor(Math.random() * focusAdvices.length);
        adviceText.innerText = `"${focusAdvices[randomIndex]}"`;
    }
}
}
}
function deleteGoal(id) {
    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const confirmDelete = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ");

    // Ø¥Ø°Ø§ Ø¶ØºØ· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ "Ù…ÙˆØ§ÙÙ‚" ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù
    if (confirmDelete) {
        let allData = JSON.parse(localStorage.getItem('user_vault_2026'));
        allData[currentUser] = allData[currentUser].filter(g => g.id !== id);
        localStorage.setItem('user_vault_2026', JSON.stringify(allData));
        loadData();
    }
    // Ø¥Ø°Ø§ Ø¶ØºØ· "Ø¥Ù„ØºØ§Ø¡" Ù„Ù† ÙŠØ­Ø¯Ø« Ø´ÙŠØ¡ ÙˆØªØ¨Ù‚Ù‰ Ø§Ù„Ù…Ù‡Ù…Ø©
}
let myLineChart = null;
let myDoughnutChart = null;

function updateChart() {
    const allData = JSON.parse(localStorage.getItem('user_vault_2026') || '{}');
    const myGoals = allData[currentUser] || [];
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ
    const done = myGoals.filter(g => g.done).length;
    const pending = myGoals.length - done;

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø®Ø·ÙŠ (Ù…Ø«Ø§Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙŠØ§Ù…)
    const daysLabels = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];
    const completionData = daysLabels.map(day => {
        return myGoals.filter(g => g.day === day && g.done).length;
    });

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    if(myLineChart) myLineChart.destroy();
    if(myDoughnutChart) myDoughnutChart.destroy();

    const ctxLine = document.getElementById('lineChart').getContext('2d');
    const ctxDonut = document.getElementById('doughnutChart').getContext('2d');

    // 1. Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø®Ø·ÙŠ (Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ)
    myLineChart = new Chart(ctxLine, {
        type: 'line',
        data: {
            labels: daysLabels,
            datasets: [{
                label: 'Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©',
                data: completionData,
                borderColor: '#6366f1',
                backgroundColor: 'rgba(99, 102, 241, 0.2)',
                fill: true,
                tension: 0.4, // Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø®Ø· Ù…Ù†Ø­Ù†ÙŠ Ø¨Ø´ÙƒÙ„ Ø§Ù†Ø³ÙŠØ§Ø¨ÙŠ
                pointRadius: 5
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
                x: { grid: { display: false }, ticks: { color: '#94a3b8', font: { family: 'Cairo' } } }
            }
        }
    });

    // 2. Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ (Ø§Ù„ØªÙˆØ²ÙŠØ¹)
    myDoughnutChart = new Chart(ctxDonut, {
        type: 'doughnut',
        data: {
            labels: ['Ù…Ù†Ø¬Ø²', 'Ù…ØªØ¨Ù‚ÙŠ'],
            datasets: [{
                data: [done, pending],
                backgroundColor: ['#10b981', '#1e293b'],
                borderWidth: 0,
                hoverOffset: 10
            }]
        },
        options: {
            cutout: '70%', // Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø£Ù†Ø­Ù ÙˆØ£ÙƒØ«Ø± Ø¹ØµØ±ÙŠØ©
            plugins: { legend: { position: 'bottom', labels: { color: '#fff', font: { family: 'Cairo' } } } }
        }
    });
}
const CACHE_NAME = 'madar-cache-v1';
const assets = ['./', './index.html'];

self.addEventListener('install', e => {
  e.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(assets)));
});

self.addEventListener('fetch', e => {
  e.respondWith(caches.match(e.request).then(res => res || fetch(e.request)));
});
let timer;
let isRunning = false;

// 1. ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯
function updateDisplay(secondsLeft) {
 let minutes = Math.floor(secondsLeft / 60);
    let seconds = secondsLeft % 60;
    let timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    document.getElementById('timer-display').textContent = timeString;
    
    const mode = localStorage.getItem('pomodoro_mode') || 'focus';
    document.title = `(${timeString}) ${mode === 'focus' ? 'ØªØ±ÙƒÙŠØ²' : 'Ø±Ø§Ø­Ø©'}`;
}

// 2. Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª (Ù…Ø¹ Ù…ÙŠØ²Ø© Ø§Ù„Ø­ÙØ¸ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«)
function startTimer() {
if (isRunning) return;

    let endTime = localStorage.getItem('pomodoro_end_time');
    
    if (!endTime) {
        // Ø¥Ø°Ø§ Ø¨Ø¯Ø£Ù†Ø§ Ù…Ù† Ø¬Ø¯ÙŠØ¯ØŒ Ù†Ø­Ø³Ø¨ ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙˆÙ†Ø®Ø²Ù†Ù‡
        let timeLeft = parseInt(localStorage.getItem('pomodoro_time_left')) || 55 * 60;
        endTime = Date.now() + (timeLeft * 1000);
        localStorage.setItem('pomodoro_end_time', endTime);
    }

    isRunning = true;
    document.getElementById('start-btn').style.display = 'none';
    document.getElementById('pause-btn').style.display = 'inline-block';

    timer = setInterval(() => {
        let now = Date.now();
        let secondsLeft = Math.round((endTime - now) / 1000);

        if (secondsLeft > 0) {
            updateDisplay(secondsLeft);
            localStorage.setItem('pomodoro_time_left', secondsLeft);
        } else {
            handleTimerEnd();
        }
    }, 1000);
}
// 3. Ù…Ø§Ø°Ø§ ÙŠØ­Ø¯Ø« Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª (Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª)
function handleTimerEnd() {
  clearInterval(timer);
    isRunning = false;
    localStorage.removeItem('pomodoro_end_time');
    document.getElementById('alarm-sound').play();

    let mode = localStorage.getItem('pomodoro_mode') || 'focus';

    if (mode === 'focus') {
        localStorage.setItem('pomodoro_mode', 'break');
        localStorage.setItem('pomodoro_time_left', 5 * 60);
        startTimer(); // Ø§Ø³ØªØ±Ø§Ø­Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
    } else {
        localStorage.setItem('pomodoro_mode', 'focus');
        localStorage.setItem('pomodoro_time_left', 55 * 60);
        updateDisplay(55 * 60);
        showMadarAdvice(); // <--- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙŠØ­Ø© Ù‡Ù†Ø§

        // Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        setTimeout(() => {
            if (confirm("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©! Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© ØªØ±ÙƒÙŠØ² Ø¬Ø¯ÙŠØ¯Ø©ØŸ")) {
                startTimer();
            } else {
                document.getElementById('start-btn').style.display = 'inline-block';
                document.getElementById('pause-btn').style.display = 'none';
            }
        }, 500);
    }
}
// 4. Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª
function pauseTimer() {
  clearInterval(timer);
    isRunning = false;
    localStorage.removeItem('pomodoro_end_time');
    document.getElementById('start-btn').style.display = 'inline-block';
    document.getElementById('pause-btn').style.display = 'none';
}

// 5. Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·
function resetTimer() {
    pauseTimer();
    localStorage.setItem('pomodoro_mode', 'focus');
    localStorage.setItem('pomodoro_time_left', 55 * 60);
    updateDisplay(55 * 60);
}

// 6. ÙØ­Øµ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© (Ù„ÙƒÙŠ Ù„Ø§ ÙŠØªÙˆÙ‚Ù)
function checkTimerOnLoad() {
let endTime = localStorage.getItem('pomodoro_end_time');
    
    if (endTime) {
        let now = Date.now();
        if (now < endTime) {
            startTimer(); // ÙŠØ³ØªØ£Ù†Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø£Ù† Ø§Ù„ÙˆÙ‚Øª Ù„Ù… ÙŠÙ†ØªÙ‡Ù Ø¨Ø¹Ø¯
        } else {
            handleTimerEnd(); // Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª ÙˆØ£Ù†Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        }
    } else {
        let timeLeft = localStorage.getItem('pomodoro_time_left') || 55 * 60;
        updateDisplay(parseInt(timeLeft));
    }
}
// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ÙØ­Øµ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
checkTimerOnLoad();
</script>
<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        // Ù†Ø³ØªØ®Ø¯Ù… ./sw.js Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­ ÙÙŠ GitHub Pages
        navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('ØªÙ… ØªÙØ¹ÙŠÙ„ Ù…ÙŠØ²Ø© Ø§Ù„Ø¹Ù…Ù„ Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª âœ…'))
        .catch(err => console.log('ÙØ´Ù„ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙŠØ²Ø© âŒ', err));
    });
}
const API_KEY = "AIzaSyBnjwadLpTp0O0QujyA4wwLzzQaPzHj21A";

    function toggleChat() {
        const win = document.getElementById('chat-window');
        win.style.display = (win.style.display === 'flex') ? 'none' : 'flex';
    }

    function handleKeyPress(e) {
        if (e.key === 'Enter') askAI();
    }

    async function askAI() {
        const inputField = document.getElementById('user-input');
        const messageBox = document.getElementById('chat-messages');
        const text = inputField.value.trim();

        if (!text) return;

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        messageBox.innerHTML += `<div class="msg user">${text}</div>`;
        inputField.value = '';
        messageBox.scrollTop = messageBox.scrollHeight;

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: text }] }]
                })
            });

            const data = await response.json();
            const aiResponse = data.candidates[0].content.parts[0].text;

            messageBox.innerHTML += `<div class="msg bot">${aiResponse}</div>`;
        } catch (error) {
            messageBox.innerHTML += `<div class="msg bot" style="color:#ff5f56;">Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† Ù…ÙØªØ§Ø­ API.</div>`;
        }
        messageBox.scrollTop = messageBox.scrollHeight;
    }
</script>
</body>
</html>
